# APK åŠ¨æ€åˆ†æå¹³å°

> é«˜æ€§èƒ½ Android åº”ç”¨è‡ªåŠ¨åŒ–åˆ†æå¹³å° - Go è¯­è¨€å®ç°
>
> **ç‰ˆæœ¬**: 1.0.0 | **æœ€åæ›´æ–°**: 2025-11-14

[![Go Version](https://img.shields.io/badge/Go-1.21+-00ADD8?style=flat&logo=go)](https://golang.org)
[![License](https://img.shields.io/badge/License-MIT-green.svg)](LICENSE)
[![Platform](https://img.shields.io/badge/Platform-Linux-lightgrey)](https://www.linux.org/)

---

## ğŸ“‹ ç›®å½•

- [åŠŸèƒ½ç‰¹æ€§](#åŠŸèƒ½ç‰¹æ€§)
- [æŠ€æœ¯æ¶æ„](#æŠ€æœ¯æ¶æ„)
- [å¿«é€Ÿå¼€å§‹](#å¿«é€Ÿå¼€å§‹)
- [æ ¸å¿ƒåŠŸèƒ½](#æ ¸å¿ƒåŠŸèƒ½)
- [API æ–‡æ¡£](#api-æ–‡æ¡£)
- [æ•…éšœæ’æŸ¥](#æ•…éšœæ’æŸ¥)
- [æ€§èƒ½æŒ‡æ ‡](#æ€§èƒ½æŒ‡æ ‡)
- [æŠ€æœ¯æ–‡æ¡£](#æŠ€æœ¯æ–‡æ¡£)

---

## ğŸ¯ åŠŸèƒ½ç‰¹æ€§

### æ ¸å¿ƒåŠŸèƒ½

- âœ… **é™æ€åˆ†æ**ï¼šåŸºäº MobSF çš„æ·±åº¦å®‰å…¨æ‰«æ
- âœ… **åŠ¨æ€åˆ†æ**ï¼šè‡ªåŠ¨åŒ– Activity éå† + AI æ™ºèƒ½äº¤äº’
- âœ… **æµé‡æ•è·**ï¼šMitmproxy + Frida SSL Unpinningï¼ˆ80-90% è¦†ç›–ç‡ï¼‰
- âœ… **åŸŸååˆ†æ**ï¼šä¸»åŸŸåè¯†åˆ« + å¤‡æ¡ˆæŸ¥è¯¢ + ç¬¬ä¸‰æ–¹ SDK è¯†åˆ«
- âœ… **æ™ºèƒ½è¿‡æ»¤**ï¼šè‡ªåŠ¨è·³è¿‡ç³»ç»Ÿç»„ä»¶å’Œæ— æ•ˆ Activity
- âœ… **å¯è§†åŒ–æŠ¥å‘Š**ï¼šActivity æ‰§è¡ŒæŠ¥å‘Š + MobSF å®‰å…¨æŠ¥å‘Š

### æŠ€æœ¯äº®ç‚¹

- ğŸš€ **é«˜æ€§èƒ½**ï¼šç›¸æ¯” Python ç‰ˆæœ¬æå‡ 6-10 å€
- ğŸ”„ **åŒæ¨¡æ‹Ÿå™¨**ï¼šçƒ­å¤‡ä»½æœºåˆ¶ï¼Œæ”¯æŒ 2-4 ä¸ªå¹¶å‘ä»»åŠ¡
- ğŸ”’ **å¹¶å‘å®‰å…¨**ï¼šADB è¿æ¥ç®¡ç†å™¨ï¼Œè§£å†³ç«æ€æ¡ä»¶
- ğŸ¤– **è‡ªåŠ¨åŒ–**ï¼šè¯ä¹¦è‡ªåŠ¨å®‰è£…ï¼Œè®¾å¤‡å¥åº·æ£€æŸ¥
- ğŸ“Š **ç›‘æ§å®Œå–„**ï¼šPrometheus + Grafana å®æ—¶ç›‘æ§

---

## ğŸ—ï¸ æŠ€æœ¯æ¶æ„

### æ•´ä½“æ¶æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Frontend / API Client                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                           â”‚
                           â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚           Gin HTTP Server (Port 8080)                       â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚Task API  â”‚  â”‚File API  â”‚  â”‚MobSF API â”‚  â”‚SDK API   â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                           â”‚
              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
              â–¼                         â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚  RabbitMQ       â”‚       â”‚  MobSF Queue    â”‚
    â”‚  Task Queue     â”‚       â”‚  Manager        â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â”‚                         â”‚
             â–¼                         â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚  Worker Pool    â”‚       â”‚  MobSF Service  â”‚
    â”‚  (4-8 workers)  â”‚       â”‚  (Parallel)     â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â”‚
             â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚      Core Orchestrator (æ ¸å¿ƒç¼–æ’å™¨)        â”‚
    â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
    â”‚  â”‚ 1. è®¾å¤‡è¿æ¥ (ADB)                     â”‚ â”‚
    â”‚  â”‚ 2. è¯ä¹¦å®‰è£… (è‡ªåŠ¨)                    â”‚ â”‚
    â”‚  â”‚ 3. APK å®‰è£…                           â”‚ â”‚
    â”‚  â”‚ 4. Frida æ³¨å…¥ (SSL Unpinning)         â”‚ â”‚
    â”‚  â”‚ 5. ä»£ç†è®¾ç½®                           â”‚ â”‚
    â”‚  â”‚ 6. Activity éå†                      â”‚ â”‚
    â”‚  â”‚ 7. æµé‡å½’å›                            â”‚ â”‚
    â”‚  â”‚ 8. æ•°æ®æ”¶é›†                           â”‚ â”‚
    â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â”‚
     â”Œâ”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
     â–¼       â–¼        â–¼          â–¼          â–¼
  â”Œâ”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚MySQLâ”‚ â”‚Redisâ”‚ â”‚MitmProxyâ”‚ â”‚Android â”‚ â”‚Android â”‚
  â”‚     â”‚ â”‚     â”‚ â”‚ -1 & -2â”‚ â”‚ Emu-1  â”‚ â”‚ Emu-2  â”‚
  â””â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### æ ¸å¿ƒç»„ä»¶

| ç»„ä»¶ | åŠŸèƒ½ | æŠ€æœ¯æ ˆ |
|------|------|--------|
| **API Server** | HTTP æ¥å£æœåŠ¡ | Gin Framework |
| **Worker Pool** | ä»»åŠ¡å¹¶å‘æ‰§è¡Œ | Goroutine Pool |
| **Orchestrator** | ä»»åŠ¡ç¼–æ’å¼•æ“ | Go |
| **Device Manager** | è®¾å¤‡æ± ç®¡ç† | åŒæ¨¡æ‹Ÿå™¨çƒ­å¤‡ä»½ |
| **ADB Connection Manager** | ADB è¿æ¥ç®¡ç† | å…¨å±€äº’æ–¥é” |
| **MobSF Queue** | é™æ€åˆ†æé˜Ÿåˆ— | å¹¶è¡Œæ‰§è¡Œ |
| **Domain Analyzer** | åŸŸååˆ†ææœåŠ¡ | å¤‡æ¡ˆæŸ¥è¯¢ + SDK è¯†åˆ« |

---

## ğŸš€ å¿«é€Ÿå¼€å§‹

### å‰ç½®è¦æ±‚

- **æ“ä½œç³»ç»Ÿ**: Linux (Ubuntu 20.04+)
- **Docker**: 20.10+
- **Docker Compose**: v2.0+
- **ç¡¬ä»¶è¦æ±‚**:
  - CPU: 8 æ ¸ä»¥ä¸Š
  - å†…å­˜: 16GB ä»¥ä¸Š
  - ç¡¬ç›˜: 100GB ä»¥ä¸Š
  - KVM æ”¯æŒï¼ˆ`ls /dev/kvm` åº”å­˜åœ¨ï¼‰

### å®‰è£…æ­¥éª¤

#### 1. å…‹éš†é¡¹ç›®

```bash
git clone <repository-url>
cd apk-analysis-go
```

#### 2. é…ç½®ç¯å¢ƒå˜é‡

```bash
cp .env.example .env
vim .env  # ä¿®æ”¹æ•°æ®åº“ã€MobSF API Key ç­‰é…ç½®
```

**å¿…éœ€é…ç½®**ï¼š

```bash
# MySQL æ•°æ®åº“
MYSQL_HOST=your-mysql-host
MYSQL_USER=your-user
MYSQL_PASS=your-password
MYSQL_DB=apk_analysis

# MobSF API Key
MOBSF_API_KEY=your-mobsf-api-key

# RabbitMQ
RABBITMQ_USER=your-user
RABBITMQ_PASS=your-password
```

#### 3. å¯åŠ¨æœåŠ¡

```bash
# å¯åŠ¨æ‰€æœ‰æœåŠ¡
docker-compose -f docker-compose.prod.yml up -d

# æŸ¥çœ‹æœåŠ¡çŠ¶æ€
docker-compose -f docker-compose.prod.yml ps

# æŸ¥çœ‹æ—¥å¿—
docker-compose -f docker-compose.prod.yml logs -f apk-analysis-server
```

#### 4. éªŒè¯éƒ¨ç½²

```bash
# æ£€æŸ¥ API å¥åº·çŠ¶æ€
curl http://localhost:8080/api/health

# æ£€æŸ¥è®¾å¤‡çŠ¶æ€
curl http://localhost:8080/api/devices

# è®¿é—® Web ç•Œé¢
open http://localhost:8080
```

### å¯åŠ¨é¡ºåºï¼ˆæ¨èï¼‰

ä¸ºé¿å…å¯åŠ¨é—®é¢˜ï¼Œå»ºè®®æŒ‰ä»¥ä¸‹é¡ºåºå¯åŠ¨ï¼š

```bash
# 1. åŸºç¡€æœåŠ¡
docker-compose -f docker-compose.prod.yml up -d rabbitmq redis mysql

# 2. Mitmproxy
docker-compose -f docker-compose.prod.yml up -d mitmproxy-1 mitmproxy-2

# 3. Android æ¨¡æ‹Ÿå™¨ï¼ˆè€—æ—¶æœ€é•¿ï¼‰
docker-compose -f docker-compose.prod.yml up -d android-emulator-1 android-emulator-2

# 4. ç­‰å¾…æ¨¡æ‹Ÿå™¨å¯åŠ¨ï¼ˆçº¦ 2-3 åˆ†é’Ÿï¼‰
sleep 180

# 5. ä¸»æœåŠ¡ï¼ˆä¼šè‡ªåŠ¨å®‰è£…è¯ä¹¦ï¼‰
docker-compose -f docker-compose.prod.yml up -d apk-analysis-server mobsf

# 6. å…¶ä»–æœåŠ¡
docker-compose -f docker-compose.prod.yml up -d prometheus grafana
```

---

## ğŸ’¡ æ ¸å¿ƒåŠŸèƒ½

### 1. APK ä¸Šä¼ ä¸åˆ†æ

#### è‡ªåŠ¨ç›‘æ§æ¨¡å¼

å°† APK æ–‡ä»¶æ”¾å…¥ `inbound_apks/` ç›®å½•ï¼Œç³»ç»Ÿä¼šè‡ªåŠ¨ï¼š

```bash
# å¤åˆ¶ APK åˆ°ç›‘æ§ç›®å½•
cp your-app.apk inbound_apks/

# ç³»ç»Ÿè‡ªåŠ¨æ‰§è¡Œï¼š
# 1. åˆ›å»ºä»»åŠ¡è®°å½•
# 2. å‘å¸ƒåˆ°æ¶ˆæ¯é˜Ÿåˆ—
# 3. Worker è‡ªåŠ¨æ¶ˆè´¹å¹¶æ‰§è¡Œ
# 4. å®Œæˆåç”ŸæˆæŠ¥å‘Š
```

#### API æäº¤æ¨¡å¼

```bash
# é€šè¿‡ API æäº¤ä»»åŠ¡ï¼ˆå¼€å‘ä¸­ï¼‰
curl -X POST http://localhost:8080/api/tasks \
  -F "apk=@your-app.apk"
```

### 2. ä»»åŠ¡æ‰§è¡Œæµç¨‹

```
ä¸Šä¼  APK
   â”‚
   â–¼
åˆ›å»ºä»»åŠ¡ (queued)
   â”‚
   â–¼
åˆ†é…è®¾å¤‡ (installing)
   â”‚
   â”œâ”€â–º å¹¶è¡Œ: MobSF é™æ€åˆ†æ
   â”‚
   â”œâ”€â–º ä¸»æµç¨‹:
   â”‚   â”œâ”€ è¿æ¥è®¾å¤‡
   â”‚   â”œâ”€ å®‰è£…è¯ä¹¦ï¼ˆè‡ªåŠ¨ï¼‰
   â”‚   â”œâ”€ å®‰è£… APK
   â”‚   â”œâ”€ Frida æ³¨å…¥
   â”‚   â”œâ”€ Activity éå† (running)
   â”‚   â””â”€ æµé‡å½’å› 
   â”‚
   â–¼
ç­‰å¾… MobSF å®Œæˆ (collecting)
   â”‚
   â–¼
åŸŸååˆ†æ
   â”‚
   â–¼
ä»»åŠ¡å®Œæˆ (completed)
```

### 3. åŒæ¨¡æ‹Ÿå™¨çƒ­å¤‡ä»½

ç³»ç»Ÿæ”¯æŒ 2 ä¸ª Android æ¨¡æ‹Ÿå™¨å¹¶å‘æ‰§è¡Œä»»åŠ¡ï¼š

| æ¨¡æ‹Ÿå™¨ | ADB ç«¯å£ | Mitmproxy ç«¯å£ | çŠ¶æ€ |
|--------|---------|----------------|------|
| emulator-1 | 5555 | 8082 | ä¸»è®¾å¤‡ |
| emulator-2 | 5557 | 8084 | å¤‡ä»½è®¾å¤‡ |

**è‡ªåŠ¨æ•…éšœæ¢å¤**ï¼š
- âœ… æ¯ 5 åˆ†é’Ÿå¥åº·æ£€æŸ¥
- âœ… æ£€æµ‹åˆ°å¼‚å¸¸è‡ªåŠ¨é‡å¯å®¹å™¨
- âœ… é‡å¯åè‡ªåŠ¨å®‰è£…è¯ä¹¦
- âœ… æ— ç¼åˆ‡æ¢ï¼Œä»»åŠ¡ä¸ä¸­æ–­

### 4. HTTPS æµé‡æ‹¦æˆª

**æŠ€æœ¯æ–¹æ¡ˆ**ï¼šç”¨æˆ·è¯ä¹¦ + Frida SSL Unpinning

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Android App                             â”‚
â”‚  â””â”€ HTTPS Request                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â”‚
               â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Android ç³»ç»Ÿ                            â”‚
â”‚  â””â”€ ç”¨æˆ·è¯ä¹¦ç›®å½•                        â”‚
â”‚     /data/misc/user/0/cacerts-added/    â”‚
â”‚     â””â”€ c8750f0d.0 (mitmproxy cert) âœ…   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â”‚
               â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Frida SSL Unpinning                     â”‚
â”‚  â””â”€ ç»•è¿‡è¯ä¹¦å›ºå®šæ£€æŸ¥ âœ…                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â”‚
               â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Wi-Fi Proxy: 10.0.3.1:8082              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â”‚
               â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Mitmproxy                               â”‚
â”‚  â””â”€ è§£å¯†å¹¶è®°å½•æµé‡ âœ…                   â”‚
â”‚  â””â”€ ä¿å­˜åˆ° flows.jsonl                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**è¦†ç›–ç‡**ï¼š80-90% çš„åº”ç”¨

**è‡ªåŠ¨åŒ–**ï¼š
- âœ… æœåŠ¡å¯åŠ¨æ—¶è‡ªåŠ¨å®‰è£…è¯ä¹¦ï¼ˆå¸¦é‡è¯•ï¼‰
- âœ… è®¾å¤‡é‡å¯åè‡ªåŠ¨å®‰è£…è¯ä¹¦
- âœ… å¥åº·æ£€æŸ¥æ¢å¤åè‡ªåŠ¨å®‰è£…è¯ä¹¦

---

## ğŸ“¡ API æ–‡æ¡£

### åŸºç¡€ä¿¡æ¯

- **Base URL**: `http://localhost:8080/api`
- **å“åº”æ ¼å¼**: JSON
- **æ—¶åŒº**: UTCï¼ˆåŒ…å« CST å­—æ®µï¼‰

### æ ¸å¿ƒæ¥å£

#### 1. è·å–ä»»åŠ¡åˆ—è¡¨

```http
GET /api/tasks?limit=50
```

**å“åº”ç¤ºä¾‹**ï¼š

```json
{
  "page": 1,
  "page_size": 20,
  "total": 156,
  "tasks": [
    {
      "id": "550e8400-e29b-41d4-a716-446655440000",
      "apk_name": "example.apk",
      "package_name": "com.example.app",
      "status": "completed",
      "progress_percent": 100,
      "mobsf_score": 85,
      "created_at_cst": "2025/11/14 13:30:00",
      "completed_at_cst": "2025/11/14 13:45:00"
    }
  ]
}
```

#### 2. è·å–ä»»åŠ¡è¯¦æƒ…

```http
GET /api/tasks/:id
```

#### 3. åˆ é™¤ä»»åŠ¡

```http
DELETE /api/tasks/:id
```

#### 4. æ‰¹é‡åˆ é™¤

```http
DELETE /api/tasks/batch
Content-Type: application/json

{
  "status": "completed",
  "before_days": 7
}
```

#### 5. åœæ­¢ä»»åŠ¡

```http
POST /api/tasks/:id/stop
```

#### 6. è·å–è®¾å¤‡çŠ¶æ€

```http
GET /api/devices
```

**å“åº”ç¤ºä¾‹**ï¼š

```json
{
  "total_devices": 2,
  "available": 1,
  "in_use": 1,
  "devices": [
    {
      "id": "emulator-1",
      "adb_target": "android-emulator-1:5555",
      "in_use": false,
      "task_id": ""
    },
    {
      "id": "emulator-2",
      "adb_target": "android-emulator-2:5555",
      "in_use": true,
      "task_id": "550e8400-..."
    }
  ]
}
```

#### 7. è·å–ç³»ç»Ÿç»Ÿè®¡

```http
GET /api/stats
```

#### 8. è·å– MobSF æŠ¥å‘Š

```http
GET /api/tasks/:id/mobsf        # JSON æ ¼å¼
GET /api/tasks/:id/mobsf/report # HTML æ ¼å¼
```

#### 9. è·å– Activity æŠ¥å‘Š

```http
GET /api/tasks/:id/activities/report  # HTML æŠ¥å‘Š
```

#### 10. ä¸‹è½½æµé‡è®°å½•

```http
GET /api/tasks/:id/flows  # flows.jsonl
```

### å®Œæ•´ API æ–‡æ¡£

è¯¦è§ï¼š[CLAUDE.md - API æ¥å£æ–‡æ¡£ç« èŠ‚](./CLAUDE.md#api-æ¥å£æ–‡æ¡£)

---

## ğŸ”§ æ•…éšœæ’æŸ¥

### å¸¸è§é—®é¢˜

#### 1. æ¨¡æ‹Ÿå™¨æ— æ³•å¯åŠ¨

**ç—‡çŠ¶**ï¼š
```
docker logs apk-analysis-android-emulator-1
# è¾“å‡º: device (exit status 1; not expected)
```

**åŸå› **ï¼šKVM æƒé™é—®é¢˜

**è§£å†³**ï¼š

```bash
# æ£€æŸ¥ KVM è®¾å¤‡
ls -la /dev/kvm

# è·å– KVM ç»„ ID
stat -c '%g' /dev/kvm

# åœ¨ docker-compose.prod.yml ä¸­æ·»åŠ 
services:
  android-emulator-1:
    group_add:
      - "993"  # æ›¿æ¢ä¸ºå®é™…çš„ KVM ç»„ ID
```

#### 2. è¯ä¹¦æœªå®‰è£…

**ç—‡çŠ¶**ï¼šæ²¡æœ‰æ•è·åˆ° HTTPS æµé‡

**æ£€æŸ¥**ï¼š

```bash
# æ£€æŸ¥è¯ä¹¦æ˜¯å¦å·²å®‰è£…
adb -s localhost:5555 shell "ls -l /data/misc/user/0/cacerts-added/c8750f0d.0"

# æ‰‹åŠ¨å®‰è£…ï¼ˆå¦‚æœè‡ªåŠ¨å®‰è£…å¤±è´¥ï¼‰
bash scripts/install_user_cert.sh localhost:5555 apk-analysis-mitmproxy-1
```

#### 3. ADB daemon å†²çª

**ç—‡çŠ¶**ï¼š
```
could not install *smartsocket* listener: Address in use
```

**è§£å†³**ï¼šå·²é€šè¿‡ ADB è¿æ¥ç®¡ç†å™¨è‡ªåŠ¨è§£å†³ï¼ˆv1.0+ï¼‰

**éªŒè¯ä¿®å¤**ï¼š

```bash
# æäº¤å¤šä¸ªä»»åŠ¡æµ‹è¯•
for i in {1..5}; do
    cp test.apk inbound_apks/test_$i.apk
done

# æ£€æŸ¥å¤±è´¥ä»»åŠ¡æ•°
curl -s "http://localhost:8080/api/stats" | jq '.status_breakdown.failed'
# åº”è¯¥ä¸º 0
```

#### 4. ä»»åŠ¡å¡åœ¨ installing çŠ¶æ€

**åŸå› **ï¼šè®¾å¤‡è¿æ¥å¤±è´¥æˆ– APK å®‰è£…è¶…æ—¶

**è§£å†³**ï¼š

```bash
# æ£€æŸ¥è®¾å¤‡è¿æ¥
docker exec apk-analysis-android-emulator-1 adb devices

# é‡å¯è®¾å¤‡
docker restart apk-analysis-android-emulator-1

# ç­‰å¾… 90 ç§’åæ£€æŸ¥
sleep 90
docker exec apk-analysis-android-emulator-1 adb shell "getprop sys.boot_completed"
```

#### 5. MobSF åˆ†æè¶…æ—¶

**åŸå› **ï¼šå¤§æ–‡ä»¶åˆ†æè€—æ—¶è¿‡é•¿

**è§£å†³**ï¼š

```bash
# åœ¨ .env ä¸­å¢åŠ è¶…æ—¶æ—¶é—´
MOBSF_TIMEOUT=7200  # 2 å°æ—¶
```

### æ—¥å¿—æŸ¥çœ‹

```bash
# ä¸»æœåŠ¡æ—¥å¿—
docker logs -f apk-analysis-server

# è¿‡æ»¤è¯ä¹¦ç›¸å…³æ—¥å¿—
docker logs apk-analysis-server | grep -i certificate

# è¿‡æ»¤é”™è¯¯æ—¥å¿—
docker logs apk-analysis-server | grep -i error

# æŸ¥çœ‹è®¾å¤‡å¥åº·æ£€æŸ¥æ—¥å¿—
docker logs apk-analysis-server | grep -i "health check"
```

---

## ğŸ“Š æ€§èƒ½æŒ‡æ ‡

### ä¸ Python ç‰ˆæœ¬å¯¹æ¯”

| æŒ‡æ ‡ | Python ç‰ˆæœ¬ | Go ç‰ˆæœ¬ | æå‡ |
|------|------------|---------|------|
| å¯åŠ¨æ—¶é—´ | 3-5 ç§’ | < 500ms | **6-10x** |
| å†…å­˜å ç”¨ | ~2GB | < 300MB | **6x** |
| å¹¶å‘ä»»åŠ¡ | 1-2 | 2-4 | **2-4x** |
| å•ä»»åŠ¡è€—æ—¶ | 10-20 åˆ†é’Ÿ | 6-12 åˆ†é’Ÿ | **30-50%** |
| CPU å ç”¨ | 80-100% | 40-60% | **40%** |

### ååé‡

- **ä»»åŠ¡å¤„ç†é€Ÿåº¦**ï¼š10-12 ä¸ªä»»åŠ¡/å°æ—¶ï¼ˆåŒæ¨¡æ‹Ÿå™¨ï¼‰
- **Activity éå†é€Ÿåº¦**ï¼š~30 ç§’/Activity
- **æµé‡è®°å½•**ï¼š~500 è¯·æ±‚/åˆ†é’Ÿ

### èµ„æºå ç”¨

| ç»„ä»¶ | CPU | å†…å­˜ | ç£ç›˜ |
|------|-----|------|------|
| apk-analysis-server | 10-20% | 200MB | 1GB |
| android-emulator-1 | 100-150% | 4GB | 10GB |
| android-emulator-2 | 100-150% | 4GB | 10GB |
| mitmproxy-1 | 5-10% | 100MB | 500MB |
| mobsf | 20-40% | 1GB | 5GB |
| rabbitmq | 5% | 200MB | 1GB |
| mysql | 10% | 500MB | 10GB |

---

## ğŸ“š æŠ€æœ¯æ–‡æ¡£

### æ ¸å¿ƒæ–‡æ¡£

| æ–‡æ¡£ | è¯´æ˜ |
|------|------|
| [CLAUDE.md](./CLAUDE.md) | å®Œæ•´æŠ€æœ¯æ–‡æ¡£ï¼ˆæ¶æ„ã€APIã€é…ç½®ï¼‰ |
| [è¯ä¹¦è‡ªåŠ¨å®‰è£…æ–¹æ¡ˆ.md](./è¯ä¹¦è‡ªåŠ¨å®‰è£…æ–¹æ¡ˆ.md) | HTTPS è¯ä¹¦è‡ªåŠ¨åŒ–æ–¹æ¡ˆ |
| [ADBå¹¶å‘å†²çªè§£å†³æ–¹æ¡ˆ.md](./ADBå¹¶å‘å†²çªè§£å†³æ–¹æ¡ˆ.md) | ADB è¿æ¥ç®¡ç†å™¨æŠ€æœ¯è¯¦è§£ |
| [åŒæ¨¡æ‹Ÿå™¨çƒ­å¤‡ä»½æ–¹æ¡ˆå®æ–½æ–‡æ¡£.md](./åŒæ¨¡æ‹Ÿå™¨çƒ­å¤‡ä»½æ–¹æ¡ˆå®æ–½æ–‡æ¡£.md) | åŒæ¨¡æ‹Ÿå™¨æ¶æ„è®¾è®¡ |

### é¡¹ç›®ç»“æ„

```
apk-analysis-go/
â”œâ”€â”€ cmd/
â”‚   â””â”€â”€ server/              # ä¸»æœåŠ¡å…¥å£
â”‚       â””â”€â”€ main.go
â”œâ”€â”€ internal/                # ç§æœ‰åº”ç”¨ä»£ç 
â”‚   â”œâ”€â”€ api/                 # HTTP API å±‚
â”‚   â”‚   â”œâ”€â”€ router.go
â”‚   â”‚   â””â”€â”€ handlers/
â”‚   â”œâ”€â”€ adb/                 # ADB å®¢æˆ·ç«¯
â”‚   â”‚   â”œâ”€â”€ client.go
â”‚   â”‚   â””â”€â”€ connection_manager.go  # ğŸ†• è¿æ¥ç®¡ç†å™¨
â”‚   â”œâ”€â”€ cert/                # è¯ä¹¦å®‰è£…
â”‚   â”‚   â””â”€â”€ installer.go
â”‚   â”œâ”€â”€ device/              # è®¾å¤‡ç®¡ç†
â”‚   â”‚   â””â”€â”€ device.go
â”‚   â”œâ”€â”€ worker/              # ä»»åŠ¡æ‰§è¡Œ
â”‚   â”‚   â”œâ”€â”€ pool.go
â”‚   â”‚   â””â”€â”€ orchestrator.go
â”‚   â”œâ”€â”€ mobsf/               # MobSF é›†æˆ
â”‚   â”‚   â”œâ”€â”€ client.go
â”‚   â”‚   â””â”€â”€ queue.go
â”‚   â”œâ”€â”€ domainanalysis/      # åŸŸååˆ†æ
â”‚   â”‚   â”œâ”€â”€ analyzer.go
â”‚   â”‚   â”œâ”€â”€ beian.go
â”‚   â”‚   â””â”€â”€ sdk_manager.go
â”‚   â””â”€â”€ ...
â”œâ”€â”€ scripts/                 # è„šæœ¬å·¥å…·
â”‚   â”œâ”€â”€ install_user_cert.sh      # ğŸ†• ç”¨æˆ·è¯ä¹¦å®‰è£…
â”‚   â””â”€â”€ init_emulator_for_mitm.sh
â”œâ”€â”€ web/                     # å‰ç«¯èµ„æº
â”‚   â”œâ”€â”€ templates/
â”‚   â”‚   â””â”€â”€ dashboard.html
â”‚   â””â”€â”€ static/
â”œâ”€â”€ configs/
â”‚   â””â”€â”€ config.yaml
â”œâ”€â”€ docker-compose.prod.yml
â”œâ”€â”€ Dockerfile
â””â”€â”€ .env.example
```

### å¼€å‘æŒ‡å—

#### ç¼–è¯‘

```bash
# å¼€å‘ç¯å¢ƒç¼–è¯‘
go build -o apk-analysis-server ./cmd/server

# ç”Ÿäº§ç¯å¢ƒç¼–è¯‘ï¼ˆä¼˜åŒ–ï¼‰
go build -ldflags="-s -w" -o apk-analysis-server ./cmd/server

# äº¤å‰ç¼–è¯‘ï¼ˆLinuxï¼‰
GOOS=linux GOARCH=amd64 go build -o apk-analysis-server ./cmd/server
```

#### æµ‹è¯•

```bash
# è¿è¡Œæ‰€æœ‰æµ‹è¯•
go test ./...

# è¿è¡Œç‰¹å®šåŒ…çš„æµ‹è¯•
go test ./internal/adb

# å¸¦è¦†ç›–ç‡
go test -cover ./...

# ç”Ÿæˆè¦†ç›–ç‡æŠ¥å‘Š
go test -coverprofile=coverage.out ./...
go tool cover -html=coverage.out
```

#### ä»£ç æ ¼å¼åŒ–

```bash
# æ ¼å¼åŒ–ä»£ç 
go fmt ./...

# æ£€æŸ¥ä»£ç è§„èŒƒ
golint ./...

# é™æ€åˆ†æ
go vet ./...
```

---

## ğŸ” å®‰å…¨è¯´æ˜

### è¯ä¹¦ç®¡ç†

- âœ… Mitmproxy è¯ä¹¦è‡ªåŠ¨ç”Ÿæˆï¼ˆå®¹å™¨å¯åŠ¨æ—¶ï¼‰
- âœ… è¯ä¹¦ä»…ç”¨äºå†…éƒ¨æµé‡åˆ†æ
- âœ… ä¸å¯¹å¤–æš´éœ²ç§é’¥

### æ•°æ®å®‰å…¨

- âœ… åˆ†æç»“æœä»…å­˜å‚¨åœ¨æœ¬åœ°
- âœ… æµé‡è®°å½•ä¸åŒ…å«æ•æ„Ÿå‡­è¯
- âœ… å®šæœŸæ¸…ç†è¿‡æœŸæ•°æ®

### ç½‘ç»œéš”ç¦»

- âœ… Docker ç½‘ç»œéš”ç¦»
- âœ… æ¨¡æ‹Ÿå™¨æ— æ³•è®¿é—®ä¸»æœºæ•æ„Ÿæ•°æ®
- âœ… API ä»…ç›‘å¬æœ¬åœ°ï¼ˆå¯é…ç½®ï¼‰

---

## ğŸ¤ è´¡çŒ®æŒ‡å—

æ¬¢è¿æäº¤ Issue å’Œ Pull Requestï¼

### å¼€å‘æµç¨‹

1. Fork é¡¹ç›®
2. åˆ›å»ºç‰¹æ€§åˆ†æ”¯ (`git checkout -b feature/AmazingFeature`)
3. æäº¤æ›´æ”¹ (`git commit -m 'Add some AmazingFeature'`)
4. æ¨é€åˆ°åˆ†æ”¯ (`git push origin feature/AmazingFeature`)
5. æäº¤ Pull Request

### ä»£ç è§„èŒƒ

- éµå¾ª Go å®˜æ–¹ä»£ç è§„èŒƒ
- æ·»åŠ å¿…è¦çš„æ³¨é‡Š
- ç¼–å†™å•å…ƒæµ‹è¯•
- æ›´æ–°ç›¸å…³æ–‡æ¡£

---

## ğŸ“„ License

MIT License - è¯¦è§ [LICENSE](LICENSE) æ–‡ä»¶

---

## ğŸ“ è”ç³»æ–¹å¼

- **é—®é¢˜åé¦ˆ**: [GitHub Issues](https://github.com/your-repo/issues)
- **æ–‡æ¡£ç»´æŠ¤**: APK Analysis Team

---

## ğŸ™ è‡´è°¢

æ„Ÿè°¢ä»¥ä¸‹å¼€æºé¡¹ç›®ï¼š

- [MobSF](https://github.com/MobSF/Mobile-Security-Framework-MobSF) - ç§»åŠ¨åº”ç”¨å®‰å…¨æ¡†æ¶
- [Frida](https://frida.re/) - åŠ¨æ€æ’æ¡©å·¥å…·
- [Mitmproxy](https://mitmproxy.org/) - HTTPS ä»£ç†å·¥å…·
- [Docker Android](https://github.com/budtmo/docker-android) - Docker åŒ– Android æ¨¡æ‹Ÿå™¨
- [Gin](https://gin-gonic.com/) - Go Web æ¡†æ¶
- [GORM](https://gorm.io/) - Go ORM åº“

---

**æœ€åæ›´æ–°**: 2025-11-14 | **ç‰ˆæœ¬**: 1.0.0
