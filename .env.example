# APK Analysis Platform - Production Environment Variables
# APK 动态分析平台 - 生产环境变量配置模板
#
# 使用说明:
# 1. 复制此文件为 .env
#    cp .env.example .env
# 2. 根据实际环境修改下面的配置值
# 3. 确保 .env 文件权限正确: chmod 600 .env

# ============================================
# 应用配置
# ============================================

# Gin 运行模式 (debug/release/test)
GIN_MODE=release

# API 端口
API_PORT=8080

# Prometheus metrics 端口
METRICS_PORT=9090

# 日志级别 (debug/info/warn/error)
LOG_LEVEL=info

# 日志格式 (json/text)
LOG_FORMAT=json

# ============================================
# 数据库配置 - MySQL
# ============================================

# 数据库类型 (mysql/sqlite)
DB_TYPE=mysql

# MySQL 连接配置
MYSQL_HOST=mysql
MYSQL_PORT=3306
MYSQL_USER=apk_analysis_user
MYSQL_PASS=your_secure_mysql_password_here
MYSQL_DB=apk_analysis

# MySQL Root 密码 (仅用于初始化)
MYSQL_ROOT_PASSWORD=your_secure_root_password_here

# 连接池配置
DB_MAX_IDLE_CONNS=10
DB_MAX_OPEN_CONNS=100
DB_CONN_MAX_LIFETIME=3600

# ============================================
# RabbitMQ 消息队列配置
# ============================================

RABBITMQ_HOST=rabbitmq
RABBITMQ_PORT=5672
RABBITMQ_USER=apk_analysis_user
RABBITMQ_PASS=your_secure_rabbitmq_password_here
RABBITMQ_VHOST=/

# 队列名称
RABBITMQ_QUEUE_NAME=apk_tasks

# 连接配置
RABBITMQ_PREFETCH_COUNT=1
RABBITMQ_AUTO_ACK=false

# ============================================
# Redis 缓存配置
# ============================================

REDIS_HOST=redis
REDIS_PORT=6379
REDIS_PASSWORD=
REDIS_DB=0

# 缓存过期时间 (秒)
REDIS_DEFAULT_EXPIRATION=3600

# ============================================
# 外部服务配置
# ============================================

# MobSF 静态分析服务
MOBSF_URL=http://mobsf:8000
MOBSF_API_KEY=your_mobsf_api_key_here
MOBSF_TIMEOUT=7200

# ADB 设备连接
ADB_TARGET=android-emulator:5555
ADB_CONNECT_TIMEOUT=30

# Mitmproxy 代理
MITM_PROXY=mitmproxy:8080

# ============================================
# AI 服务配置 (可选)
# ============================================

# 智谱 AI (GLM-4V)
ZAI_API_KEY=your_zhipu_ai_api_key_here
ZAI_MODEL=glm-4v-flash

# AI 功能开关
AI_UI_ANALYSIS_ENABLED=true
AI_MAX_ACTIONS_PER_ACTIVITY=20

# ============================================
# Frida 动态注入配置 (可选)
# ============================================

FRIDA_ENABLED=true
FRIDA_SERVER_VERSION=16.1.4
FRIDA_TIMEOUT=30

# ============================================
# 域名分析配置
# ============================================

# IP138 归属地查询
IP138_URL=https://api.ip138.com/ip/?datatype=jsonp&ip=
IP138_TOKEN=your_ip138_token_here

# 备案查询 API
BEIAN_API_URL=https://api.example.com/beian
BEIAN_API_KEY=your_beian_api_key_here

# ============================================
# 文件存储配置
# ============================================

# APK 上传目录
INBOUND_APKS_DIR=/app/inbound_apks

# 分析结果目录
RESULTS_DIR=/app/results

# 日志目录
LOGS_DIR=/app/logs

# 临时文件目录
TEMP_DIR=/tmp/apk_analysis

# ============================================
# 任务执行配置
# ============================================

# Worker 数量
WORKER_COUNT=4

# 任务超时时间 (秒)
TASK_TIMEOUT=3600

# Activity 遍历超时 (秒)
ACTIVITY_TIMEOUT=300

# 模拟器重启间隔 (每 N 个任务)
EMULATOR_RESTART_INTERVAL=5

# ============================================
# Grafana 配置
# ============================================

GRAFANA_ADMIN_USER=admin
GRAFANA_ADMIN_PASSWORD=your_secure_grafana_password_here

# ============================================
# Nginx 配置 (可选)
# ============================================

# 域名
NGINX_DOMAIN=apk-analysis.example.com

# SSL 证书路径
NGINX_SSL_CERT=/etc/nginx/ssl/fullchain.pem
NGINX_SSL_KEY=/etc/nginx/ssl/privkey.pem

# ============================================
# 监控配置
# ============================================

# Prometheus 数据保留时间 (天)
PROMETHEUS_RETENTION_DAYS=30

# 告警配置
ALERTMANAGER_URL=http://alertmanager:9093
ALERT_EMAIL=admin@example.com

# ============================================
# 安全配置
# ============================================

# JWT Secret (用于 API 认证, 可选)
JWT_SECRET=your_jwt_secret_key_here

# API Rate Limiting
RATE_LIMIT_ENABLED=true
RATE_LIMIT_REQUESTS_PER_MINUTE=60

# ============================================
# 代理配置
# ============================================

# 不使用代理的地址列表
NO_PROXY=mobsf,localhost,127.0.0.1,open.bigmodel.cn
no_proxy=mobsf,localhost,127.0.0.1,open.bigmodel.cn

# HTTP 代理 (可选)
HTTP_PROXY=
HTTPS_PROXY=

# ============================================
# 时区配置
# ============================================

TZ=Asia/Shanghai

# ============================================
# 调试配置 (生产环境建议关闭)
# ============================================

# 启用 pprof 性能分析
PPROF_ENABLED=false
PPROF_PORT=6060

# 启用详细日志
VERBOSE_LOGGING=false

# ============================================
# 备份配置
# ============================================

# 数据库备份路径
BACKUP_DIR=/app/backups

# 自动备份间隔 (小时)
AUTO_BACKUP_INTERVAL=24

# 备份保留天数
BACKUP_RETENTION_DAYS=30

# ============================================
# 资源限制配置
# ============================================

# 最大并发任务数
MAX_CONCURRENT_TASKS=2

# 最大 APK 文件大小 (MB)
MAX_APK_SIZE=500

# 最大截图数量
MAX_SCREENSHOTS=100

# ============================================
# 特性开关
# ============================================

# 启用 Activity 智能过滤
ACTIVITY_FILTER_ENABLED=true

# 启用 MobSF 分析
MOBSF_ANALYSIS_ENABLED=true

# 启用流量捕获
TRAFFIC_CAPTURE_ENABLED=true

# 启用 UI 层级捕获
UI_HIERARCHY_CAPTURE_ENABLED=true

# 启用截图捕获
SCREENSHOT_CAPTURE_ENABLED=true

# 启用域名分析
DOMAIN_ANALYSIS_ENABLED=true

# 启用备案查询
BEIAN_CHECK_ENABLED=true

# ============================================
# 开发/测试配置 (生产环境请删除或注释)
# ============================================

# DEV_MODE=false
# TEST_MODE=false
# MOCK_EXTERNAL_SERVICES=false
