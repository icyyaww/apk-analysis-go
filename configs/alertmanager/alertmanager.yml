global:
  resolve_timeout: 5m
  # SMTP é…ç½® (é‚®ä»¶å‘Šè­¦)
  smtp_smarthost: 'smtp.example.com:587'
  smtp_from: 'alerts@apk-analysis.com'
  smtp_auth_username: 'alerts@apk-analysis.com'
  smtp_auth_password: 'your_password_here'
  smtp_require_tls: true

# å‘Šè­¦è·¯ç”±é…ç½®
route:
  # é»˜è®¤æ¥æ”¶è€…
  receiver: 'default-receiver'

  # åˆ†ç»„é…ç½®
  group_by: ['alertname', 'component', 'severity']
  group_wait: 30s           # åˆ†ç»„ç­‰å¾…æ—¶é—´
  group_interval: 5m        # åˆ†ç»„å‘Šè­¦å‘é€é—´éš”
  repeat_interval: 12h      # é‡å¤å‘Šè­¦é—´éš”

  # è·¯ç”±è§„åˆ™
  routes:
    # ä¸¥é‡çº§åˆ«å‘Šè­¦ (ç«‹å³å‘é€)
    - match:
        severity: critical
      receiver: 'critical-alerts'
      group_wait: 10s
      repeat_interval: 1h

    # è­¦å‘Šçº§åˆ«å‘Šè­¦
    - match:
        severity: warning
      receiver: 'warning-alerts'
      group_wait: 30s
      repeat_interval: 6h

    # ç³»ç»Ÿç»„ä»¶å‘Šè­¦
    - match:
        component: system
      receiver: 'system-alerts'

    # ä»»åŠ¡ç›¸å…³å‘Šè­¦
    - match:
        component: task
      receiver: 'task-alerts'

    # æ•°æ®åº“å‘Šè­¦
    - match:
        component: database
      receiver: 'database-alerts'

# æ¥æ”¶è€…é…ç½®
receivers:
  # é»˜è®¤æ¥æ”¶è€… (ä»…æ—¥å¿—)
  - name: 'default-receiver'
    webhook_configs:
      - url: 'http://alertmanager-webhook:8080/alerts'
        send_resolved: true

  # ä¸¥é‡å‘Šè­¦ (é‚®ä»¶ + Webhook)
  - name: 'critical-alerts'
    email_configs:
      - to: 'ops-team@example.com'
        headers:
          Subject: '[CRITICAL] APK Analysis Platform Alert'
        html: |
          <h3>ğŸš¨ ä¸¥é‡å‘Šè­¦</h3>
          <p><strong>å‘Šè­¦åç§°:</strong> {{ .GroupLabels.alertname }}</p>
          <p><strong>ç»„ä»¶:</strong> {{ .GroupLabels.component }}</p>
          <p><strong>æè¿°:</strong> {{ .CommonAnnotations.description }}</p>
          <p><strong>æ—¶é—´:</strong> {{ .StartsAt }}</p>
    webhook_configs:
      - url: 'http://alertmanager-webhook:8080/critical'
        send_resolved: true

  # è­¦å‘Šçº§åˆ«å‘Šè­¦ (ä»…é‚®ä»¶)
  - name: 'warning-alerts'
    email_configs:
      - to: 'dev-team@example.com'
        headers:
          Subject: '[WARNING] APK Analysis Platform Alert'

  # ç³»ç»Ÿå‘Šè­¦
  - name: 'system-alerts'
    email_configs:
      - to: 'sre-team@example.com'
        headers:
          Subject: '[SYSTEM] APK Analysis Alert'

  # ä»»åŠ¡å‘Šè­¦
  - name: 'task-alerts'
    email_configs:
      - to: 'dev-team@example.com'
        headers:
          Subject: '[TASK] APK Analysis Alert'

  # æ•°æ®åº“å‘Šè­¦
  - name: 'database-alerts'
    email_configs:
      - to: 'dba-team@example.com'
        headers:
          Subject: '[DATABASE] APK Analysis Alert'

# æŠ‘åˆ¶è§„åˆ™ (é¿å…å‘Šè­¦é£æš´)
inhibit_rules:
  # ä¸¥é‡å‘Šè­¦ä¼šæŠ‘åˆ¶è­¦å‘Šå‘Šè­¦
  - source_match:
      severity: 'critical'
    target_match:
      severity: 'warning'
    equal: ['alertname', 'component']

  # æœåŠ¡å®•æœºä¼šæŠ‘åˆ¶å…¶ä»–æ‰€æœ‰å‘Šè­¦
  - source_match:
      alertname: 'ServiceDown'
    target_match_re:
      alertname: '.*'
    equal: ['component']
