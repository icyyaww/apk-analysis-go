# 未使用代码分析报告

> **分析时间：** 2025-11-26
> **分析目的：** 识别项目中未被引用或可能冗余的代码

---

## 一、未使用的模块目录

### 1. internal/cache/ - 空目录

**状态：** 未使用
**说明：** 目录存在但为空，可能是预留的缓存模块
**建议：** 删除

---

### 2. internal/retry/ - 未被引用

**状态：** 未使用
**包含文件：**
- `retry.go` - 重试工具函数
- `retry_test.go` - 测试文件

**说明：** 代码已实现但未被任何模块导入使用
**建议：** 删除（或未来需要时重新启用）

---

### 3. internal/utils/ 子目录 - 空目录

**状态：** 部分使用

| 子目录 | 状态 | 说明 |
|-------|------|------|
| `utils/dbpool.go` | ✅ 使用中 | 被 main.go 引用 |
| `utils/stream.go` | ❓ 待确认 | 需检查是否被使用 |
| `utils/errors/` | ❌ 空目录 | 删除 |
| `utils/file/` | ❌ 空目录 | 删除 |
| `utils/logger/` | ❌ 空目录 | 删除 |
| `utils/metrics/` | ❌ 空目录 | 删除 |

**建议：** 删除空子目录

---

## 二、未使用的脚本文件

### scripts/ 目录分析

| 脚本文件 | 代码引用 | 状态 | 建议 |
|---------|---------|------|------|
| `analyze_apk.py` | ✅ staticanalysis 使用 | 使用中 | 保留 |
| `mitm_jsonl_writer.py` | ✅ docker-compose 使用 | 使用中 | 保留 |
| `wait_and_install_cert.sh` | ✅ cert/installer.go | 使用中 | 保留 |
| `install_user_cert.sh` | ✅ cert/installer.go | 使用中 | 保留 |
| `prepare_and_install_cert.sh` | ✅ cert/installer.go | 使用中 | 保留 |
| `frida_ssl_unpinning_advanced.js` | ✅ frida/client.go | 使用中 | 保留 |
| `ssl_unpinning.js` | ✅ frida/client.go (备用) | 使用中 | 保留 |
| `download_frida_server.sh` | ❌ 未引用 | 手动工具 | 待确认 |
| `init_emulator_for_mitm.sh` | ❌ 未引用 | 手动工具 | 待确认 |
| `init_certificates.sh` | ❌ 未引用 | 手动工具 | 待确认 |
| `install_mitm_cert.sh` | ❌ 未引用 | 可能重复 | 删除 |
| `install_mitm_cert_aosp.sh` | ❌ 未引用 | 可能重复 | 删除 |
| `install-go.sh` | ❌ 未引用 | 开发工具 | 删除 |
| `emulator-monitor.service` | ❌ 未引用 | systemd 服务 | 待确认 |

**说明：**
- 证书安装脚本有多个版本，功能重复
- 部分脚本是手动运维工具，不在代码中引用

---

## 三、测试目录结构问题

### 问题：两个测试目录

```
test/                    # 旧目录
├── integration/         # 空目录
├── unit/               # 空目录
├── mode_switch_standalone_test.go
├── performance_benchmark_test.go
└── simple_benchmark_test.go

tests/                   # 新目录
├── integration/
│   └── integration_test.go  # 有内容
└── stress/
    └── stress_test.go       # 有内容
```

**问题：**
1. `test/` 和 `tests/` 两个目录并存，命名不一致
2. `test/integration/` 和 `test/unit/` 是空目录
3. 根目录测试文件位置混乱

**建议：**
- 删除 `test/integration/` 空目录
- 删除 `test/unit/` 空目录
- 考虑将 `test/` 下的测试文件移动到 `tests/` 统一管理

---

## 四、部署目录冗余

### deployments/ 目录分析

| 子目录 | 内容 | 状态 | 建议 |
|-------|------|------|------|
| `deployments/nginx/` | Nginx 配置 | ✅ 使用中 | 保留 |
| `deployments/prometheus/` | Prometheus 配置 | ✅ 使用中 | 保留 |
| `deployments/grafana/` | Grafana 配置 | ✅ 使用中 | 保留 |
| `deployments/docker/` | 空目录 | ❌ 未使用 | 删除 |
| `deployments/canary/` | 金丝雀发布配置 | ❓ 待确认 | 待确认 |
| `deployments/production/` | 生产部署脚本 | ❓ 待确认 | 待确认 |

**说明：** `deployments/docker/` 是空目录

---

## 五、其他可能未使用的文件

### 1. __pycache__/ 目录

**路径：** `scripts/__pycache__/`
**说明：** Python 编译缓存，应添加到 .gitignore
**建议：** 删除

---

## 六、清理建议汇总

### 高优先级（确认可删除）

| 路径 | 说明 |
|-----|------|
| `internal/cache/` | 空目录 |
| `internal/retry/` | 未使用的重试模块 |
| `internal/utils/errors/` | 空目录 |
| `internal/utils/file/` | 空目录 |
| `internal/utils/logger/` | 空目录 |
| `internal/utils/metrics/` | 空目录 |
| `test/integration/` | 空目录 |
| `test/unit/` | 空目录 |
| `deployments/docker/` | 空目录 |
| `scripts/__pycache__/` | Python 缓存 |
| `scripts/install_mitm_cert.sh` | 重复脚本 |
| `scripts/install_mitm_cert_aosp.sh` | 重复脚本 |
| `scripts/install-go.sh` | 开发工具，不需要 |

### 待确认（需要人工判断）

| 路径 | 说明 |
|-----|------|
| `scripts/download_frida_server.sh` | 可能是手动运维工具 |
| `scripts/init_emulator_for_mitm.sh` | 可能是手动运维工具 |
| `scripts/init_certificates.sh` | 可能是手动运维工具 |
| `scripts/emulator-monitor.service` | systemd 服务文件 |
| `deployments/canary/` | 金丝雀发布是否使用 |
| `deployments/production/` | 生产部署脚本是否使用 |
| `internal/utils/stream.go` | 检查是否被使用 |

---

## 七、预估清理效果

| 类别 | 数量 |
|-----|------|
| 可删除空目录 | 9 个 |
| 可删除脚本 | 3 个 |
| 可删除缓存 | 1 个 |
| 待确认项目 | 7 个 |

---

**状态：** 分析完成，待用户确认后执行清理
